{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://photoseal.example/schemas/org.photoseal.capture.v1.json",
  "title": "PhotoSeal capture assertion v1",
  "type": "object",
  "additionalProperties": false,
  "required": ["capture", "binding", "signer", "privacy"],
  "properties": {
    "capture": {
      "type": "object",
      "additionalProperties": false,
      "required": ["device_time", "lens_position"],
      "properties": {
        "device_time": { "type": "string" },
        "lens_position": { "type": "string", "enum": ["rear", "front"] },
        "exposure": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "iso": { "type": "integer", "minimum": 0 },
            "shutter_s": { "type": "number", "minimum": 0 },
            "f_number": { "type": "number", "minimum": 0 }
          }
        },
        "location": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "lat": { "type": "number", "minimum": -90, "maximum": 90 },
            "lon": { "type": "number", "minimum": -180, "maximum": 180 },
            "accuracy_m": { "type": "number", "minimum": 0 }
          }
        }
      }
    },
    "binding": {
      "type": "object",
      "additionalProperties": false,
      "required": ["preferred", "local_canonicalization"],
      "properties": {
        "preferred": { "type": "string" },
        "note": { "type": "string" },
        "local_canonicalization": {
          "type": "object",
          "additionalProperties": false,
          "required": ["type", "pixel_format", "color_space", "orientation_applied", "width", "height", "hash_alg", "hash_b64"],
          "properties": {
            "type": { "type": "string", "enum": ["pixels_v1", "file_bytes_v1"] },
            "pixel_format": { "type": "string", "enum": ["RGBA8"] },
            "color_space": { "type": "string", "enum": ["sRGB"] },
            "orientation_applied": { "type": "boolean" },
            "width": { "type": "integer", "minimum": 1 },
            "height": { "type": "integer", "minimum": 1 },
            "hash_alg": { "type": "string", "enum": ["SHA-256"] },
            "hash_b64": { "type": "string" }
          }
        }
      }
    },
    "signer": {
      "type": "object",
      "additionalProperties": false,
      "required": ["key_origin", "key_id"],
      "properties": {
        "key_origin": { "type": "string", "enum": ["secure_enclave", "unknown"] },
        "public_key_hint": { "type": "string" },
        "key_id": { "type": "string" }
      }
    },
    "privacy": {
      "type": "object",
      "additionalProperties": false,
      "required": ["location_included", "location_policy"],
      "properties": {
        "location_included": { "type": "boolean" },
        "location_policy": { "type": "string", "enum": ["opt_in", "never", "coarse_only"] }
      }
    }
  }
}
